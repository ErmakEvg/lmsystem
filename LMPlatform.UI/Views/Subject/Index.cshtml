@using LMPlatform.Models
@model LMPlatform.UI.ViewModels.SubjectViewModels.SubjectWorkingViewModel
@{
	ViewBag.Title = Model.SubjectName;
	Layout = "../Shared/Layouts/_MainUsingNavLayout.cshtml";
}

@section scripts
{
	@Scripts.Render("~/bundles/datatable", "~/Scripts/ckeditor/ckeditor.js")
	@Scripts.Render("~/bundle/subjectWorking")
	@Scripts.Render("~/bundles/textAngular")
	<script src="~/Scripts/jqplot/jquery.jqplot.min.js" type="text/javascript"></script>
	<script src="~/Scripts/jqplot/jqplot.pieRenderer.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="~/Scripts/jqplot/chart.js"></script>
}
<style>
	textarea {
		max-width: none;
	}
</style>
@{
	var userRole = User.IsInRole("student") ? 1 : 0;

	<div ng-app="mainApp" ng-controller="MainCtrl" ng-init="init('@Model.SubjectId','@userRole', '@WebSecurity.CurrentUserId')">
		@section navleft
		{
			@foreach (var module in Model.Modules.Where(e => e.Type != ModuleType.Results && e.Type != ModuleType.StatisticsVisits && e.Type != ModuleType.ScheduleProtection).ToList())
{
    if (module.Type == ModuleType.SmartTest)
    {
        <li class="navLink">
            @if (userRole == 1)
            {
                <a class="moduleLinks linkNavbar" href="@Url.Action("StudentsTesting", "TestPassing", new { subjectId = Model.SubjectId })">@module.Name</a>
            }
            else
            {
                <a class="moduleLinks linkNavbar" href="@Url.Action("KnowledgeTesting", "Tests", new { subjectId = Model.SubjectId })">@module.Name</a>
            }
        </li>
    }
    else
    {
<li class="navLink">
						<a class="moduleLinks linkNavbar" href="#@module.Type">@module.Name</a>
					</li>
	   }
   }
			@if (User.IsInRole("lector"))
   {
<li style="position: absolute; top: 70%"><a id="subGroups" class="linkNavbar" href="@Url.Action("SubGroups", "Subject", new { subjectId = Model.SubjectId })"><i class="fa fa-users fa-1x fa-tab"></i>Управление подгруппами</a></li>
   }
			<li style="position: absolute; top: 75%"><a class="linkNavbar" href="@Url.Action("Subjects", "Subject")"><i class="fa fa-reply fa-1x fa-tab"></i>Сменить предмет</a></li>
			<li style="position: absolute; top: 80%"><a class="linkNavbar" href="@Url.Action("Index", "Lms")"><i class="fa fa-arrow-left fa-1x fa-tab"></i>Назад</a></li>

		}

		<input type="hidden" ng-click="loadGroups()" id="loadGroups" />
		<div class="conteinerModule" data-subjectid="@Model.SubjectId"></div>
		<div class="page-header" style="margin-top: 10px; padding: 0">
			<h3>@Model.SubjectName</h3>
		</div>

		<div ng-view></div>
	</div>
}
<script type="text/javascript" src="~/Scripts/application/mainApp.js"></script>
<script>
	$(document).ready(function () {
		$('li.navLink').first().click();
		$('a.moduleLinks').first().click();
	});
</script>
